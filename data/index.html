<!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/html/styles.css">
    <title>ESP32 PWM Controller</title>
</head>
<body>
    <div class="box">
        <div class="sec"></div>
            <nav class="topmenu">
            <a href="#home" onclick="showSection('home')">HOME</a>
            <a href="#console" onclick="showSection('console')">CONSOLE</a>
            <a href="#tools" onclick="showSection('tools')">TOOLS</a>
            </nav>            
        </div>
        <div id="home" style="padding: 7pt;">
            <div class="sec">
            <div class="ttl active" id="btnPwm">PWM</div><span id="valuePwm">255</span>
            </div>
            <input type="range" min="0" max="8192" value="8192" class="slider" id="sliderPwm">
            <div class="sec">
            <div class="ttl">V</div><span id="valueV">0.00</span> V
            </div>
            <div class="sec">
            <div class="ttl">A</div><span id="valueA">0.00</span> A
            </div>
        </div>
        <div id="console" style="display: none;padding: 7pt;">
            <textarea style="width: 95%; height: 200px; font-family: Arial, Helvetica, sans-serif; font-size: 12pt;"></textarea>
        </div>
        <div id="tools" style="display: none;padding: 7pt;">
            <div style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt;">Build 1509</div>
            <button onclick="vm.onStartCalibration()">Start Calibration</button>
            <button onclick="vm.onReadPartitions()">Read Partitions</button>
        </div>
    </div>
    <script src="/html/main.js"></script>
    <script>
        function showSection(sectionId) {
            const sections = ['home', 'console', 'tools'];
            sections.forEach(id => {
                document.getElementById(id).style.display = id === sectionId ? 'block' : 'none';
            });
        }
        
        const btnPwm = document.getElementById("btnPwm");
        const slider = document.getElementById("sliderPwm");
        const output = document.getElementById("valuePwm");
        const uiValueV = document.getElementById("valueV");
        const uiValueA = document.getElementById("valueA");

        function updateUi(state) {
            if (state.pwmEnabled) {
                btnPwm.classList.add("red");
            } else {
                btnPwm.classList.remove("red");
            }
            output.textContent = state.pwmValue;
            slider.value = state.pwmValue * 32;
            uiValueV.textContent = state.volts;
            uiValueA.textContent = state.current;
        }
        
        const espRepo = new EspRepo();
        const vm = new ViewModel(espRepo, updateUi);
        slider.addEventListener("input", (event) => { vm.onSlider( Math.floor(event.target.value / 32));});
        btnPwm.addEventListener('click', (event) => { vm.onPwmClick(); });
    </script>
</body></html>